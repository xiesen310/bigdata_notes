---
title: centos7安装elk 
tags: elk,elasticsearch,logstash,kibana
author: XieSen
time: 2018-6-28 
grammar_cjkRuby: true
---

# elasticSearch安装

## 安装准备

为了运行ElasticSearch，第一步安装的是java，ElasticSearch需要Java7或更高的支持，建议使用java8.检查java版本的命令:`java -version`

## 安装ElasticSearch

当我们设置好java的环境之后，下载ElasticSearch，解压，安装完毕。下载地址:[elasticSearch-5-2-2](https://www.elastic.co/downloads/past-releases/elasticsearch-5-2-2)

## 配置

ElasticSearch配置文件在elasticsearch/config文件夹下，在这个文件夹内有三个文件，一个是elasticsearch配置不同模块的配置文件`elasticsearch.yml`，一个是elasticsearch的日志配置文件`log4j2.properties`，另一个是elasticsearch的jvm配置文件`jvm.options`。

``` yaml
# 集群名称
cluster.name: xs-es

# 节点名称
node.name: node-1

# 节点描述
#node.attr.rack: r1

# 索引存储位置
path.data: /home/elk/elk/elasticsearch-5.2.2/data

# 日志存储位置
path.logs: /home/elk/elk/elasticsearch-5.2.2/logs

# 内存分配模式
#bootstrap.memory_lock: true

# 绑定的网卡IP
network.host: 192.168.221.131

# http协议端口
http.port: 9200

# 开始发现新节点的IP地址
#discovery.zen.ping.unicast.hosts: ["host1", "host2"]

# 最多发现主节点的个数
#discovery.zen.minimum_master_nodes: 3

# 当重启集群节点后最少启动N个节点后开始做恢复
#gateway.recover_after_nodes: 3

# 当删除一个索引的时候，需要制定具体索引的名称
#action.destructive_requires_name: true
```

## 异常解决方案

异常描述一: `ERROR: bootstrap checks failed,max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144] `

解决方案:

1. 切换到root用户修改配置sysctl.conf `vi /etc/sysctl.conf`
2. 添加下面配置：`vm.max_map_count=655360`
3. 并执行命令：`sysctl -p`
4. 然后，重新启动elasticsearch，即可启动成功。

异常描述二: 

``` shell
max file descriptors [4096] for elasticsearch process likely too low, increase to at least [65536]
max number of threads [1024] for user [lishang] likely too low, increase to at least [2048]
```
解决方案:

``` shell
vi /etc/security/limits.conf 

添加如下内容:
* soft nofile 65536
* hard nofile 131072
* soft nproc 2048
* hard nproc 4096
```
# kibana安装

kibana是elasticsearch的一个可视化工具，在学习的过程中可以使用kibana来进行api的练习。
 
 ## 安装kibana
 
 安装kibana的前提是我们必须安装配置了elasticsearch，当下我们已经安装好了elasticsearch，下一步是下载kibana，解压，安装完毕。
 
## 配置

kibana的配置文件在kibana/conf文件夹下，里面就一个kibana的配置文件`kibana.yaml`

``` yaml
# Kibana Http协议端口 
server.port: 5601

# Kibana 主机名
server.host: "node-1"

# Enables you to specify a path to mount Kibana at if you are running behind a proxy. This only affects
# the URLs generated by Kibana, your proxy is expected to remove the basePath value before forwarding requests
# to Kibana. This setting cannot end in a slash.
#server.basePath: ""

# The maximum payload size in bytes for incoming server requests.
#server.maxPayloadBytes: 1048576

# The Kibana server's name.  This is used for display purposes.
#server.name: "your-hostname"

# The URL of the Elasticsearch instance to use for all your queries.
elasticsearch.url: "http://node-1:9200"

# When this setting's value is true Kibana uses the hostname specified in the server.host
# setting. When the value of this setting is false, Kibana uses the hostname of the host
# that connects to this Kibana instance.
#elasticsearch.preserveHost: true

# Kibana uses an index in Elasticsearch to store saved searches, visualizations and
# dashboards. Kibana creates a new index if the index doesn't already exist.
#kibana.index: ".kibana"

# The default application to load.
#kibana.defaultAppId: "discover"

# If your Elasticsearch is protected with basic authentication, these settings provide
# the username and password that the Kibana server uses to perform maintenance on the Kibana
# index at startup. Your Kibana users still need to authenticate with Elasticsearch, which
# is proxied through the Kibana server.
#elasticsearch.username: "user"
#elasticsearch.password: "pass"

# Paths to the PEM-format SSL certificate and SSL key files, respectively. These
# files enable SSL for outgoing requests from the Kibana server to the browser.
#server.ssl.cert: /path/to/your/server.crt
#server.ssl.key: /path/to/your/server.key

# Optional settings that provide the paths to the PEM-format SSL certificate and key files.
# These files validate that your Elasticsearch backend uses the same key files.
#elasticsearch.ssl.cert: /path/to/your/client.crt
#elasticsearch.ssl.key: /path/to/your/client.key

# Optional setting that enables you to specify a path to the PEM file for the certificate
# authority for your Elasticsearch instance.
#elasticsearch.ssl.ca: /path/to/your/CA.pem

# To disregard the validity of SSL certificates, change this setting's value to false.
#elasticsearch.ssl.verify: true

# Time in milliseconds to wait for Elasticsearch to respond to pings. Defaults to the value of
# the elasticsearch.requestTimeout setting.
#elasticsearch.pingTimeout: 1500

# Time in milliseconds to wait for responses from the back end or Elasticsearch. This value
# must be a positive integer.
#elasticsearch.requestTimeout: 30000

# List of Kibana client-side headers to send to Elasticsearch. To send *no* client-side
# headers, set this value to [] (an empty list).
#elasticsearch.requestHeadersWhitelist: [ authorization ]

# Header names and values that are sent to Elasticsearch. Any custom headers cannot be overwritten
# by client-side headers, regardless of the elasticsearch.requestHeadersWhitelist configuration.
#elasticsearch.customHeaders: {}

# Time in milliseconds for Elasticsearch to wait for responses from shards. Set to 0 to disable.
#elasticsearch.shardTimeout: 0

# Time in milliseconds to wait for Elasticsearch at Kibana startup before retrying.
#elasticsearch.startupTimeout: 5000

# Specifies the path where Kibana creates the process ID file.
#pid.file: /var/run/kibana.pid

# Enables you specify a file where Kibana stores log output.
#logging.dest: stdout

# Set the value of this setting to true to suppress all logging output.
#logging.silent: false

# Set the value of this setting to true to suppress all logging output other than error messages.
#logging.quiet: false

# Set the value of this setting to true to log all events, including system usage information
# and all requests.
#logging.verbose: false

# Set the interval in milliseconds to sample system and process performance
# metrics. Minimum is 100ms. Defaults to 5000.
#ops.interval: 5000
```
# logstash安装

## 下载

为了运行logstash，第一步安装的是java，ElasticSearch需要Java7或更高的支持，建议使用java8.检查java版本的命令:`java -version`
这里我使用的是logstash5.2.2，[logstash5.2.2下载地址](https://artifacts.elastic.co/downloads/logstash/logstash-5.2.2.tar.gz)

## 安装


## 调试
